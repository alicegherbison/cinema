<!DOCTYPE html>
<html lang="en-GB">
<head>
  <!--[if lt IE 9]> <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><![endif]-->
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cinema</title>
</head>
<body>
  <h1>Film finder</h1>
  <form>
    <input id="searchText" type="text">
    <div id="searchBtn">Search</div>
  </form>
  <ul id="searchOutput"></ul>
  <section></section>
  <script>
    // Browser code with Fetch API.
    var apiKey = '';
    var days = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
    var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
    
    function searchEvents() {
      var searchText = document.querySelector('#searchText').value;
      var headers = new Headers();
      headers.set('Authorization', 'Bearer '+apiKey);
      fetch('https://api.list.co.uk/v1/events?place_id=418fdadd-4f1e-b60e-03e0-bcc4000031d6&tags=film', { headers: headers })
      .then(function(response) { return response.json(); })
      .then(function(data) {
        var films = document.querySelector('section');
        films.innerHTML = '';
        data.forEach(function(film) {
          var storeDay;
          
          var filmName = document.createElement('h2');
          filmName.innerHTML = film.name;
          films.appendChild(filmName);
          
          var showtimes = document.createElement('table');
          films.appendChild(showtimes);      
          
          var showtimesData = film.schedules[0].performances;
          
          var dailyTimes = document.createElement('tr');
          
          showtimesData.forEach(function(performance) {
            
            var showing = new Date(performance.ts);
    
            var showingDay = days[showing.getDay()];
            var showingDate = showing.getDate();
            var showingMonth = months[showing.getMonth()];
            var showingYear = showing.getYear();
            var showingHour = showing.getHours();
            var showingMinutes = showing.getMinutes();
            
            var date = document.createElement('td');
            date.innerHTML = showingDay + ' ' + showingDate + ' ' + showingMonth;
            
            var showtime = document.createElement('td');
            showtime.innerHTML = showingHour + ':' + showingMinutes;
            
            dailyTimes.appendChild(showtime);
            
            if (storeDay != showingDay) {
              dailyTimes.prepend(date);
              showtimes.appendChild(dailyTimes);
              dailyTimes = document.createElement('tr');
            }
            
            storeDay = days[showing.getDay()];
            
          });
        });
      });
    }
    document.querySelector('#searchBtn')
    .addEventListener('click', searchEvents);
  </script>
</body>
</html>